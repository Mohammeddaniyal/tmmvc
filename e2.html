<!DOCTYPE HTML>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Stage 1</title>
</head>
<script src="jquery/jquery.js"></script>
<!--MVC library starts here-->
<script>

function match(text)
{
  let start = text.indexOf("{{");
  if(start==-1) return false;
  let end= text.indexOf("}}",start+2);
  if(end==-1 || start>end) return false;
  return true;
}
// var values = { name: "John", age: "25" };

function replaceMustachePlaceholders(text,values) {
return  text.replace(/{{\s*(\w+)\s*}}/g, (match, key) => {
        return values[key] !== undefined ? values[key] : match;
    });
// Output: "Hello John, you are 25 years old."

}
function replaceMustacheManual(text, values) {
    let result = "";
    let startIndex = 0;

    while (true) {
        let open = text.indexOf("{{", startIndex);
        if (open === -1) {
            // No more placeholders â€” add the rest
            result += text.substring(startIndex);
            break;
        }

        // Add text before {{
        result += text.substring(startIndex, open);
        alert(result);
        let close = text.indexOf("}}", open + 2);
        if (close === -1) {
            // No closing }}, just append rest
            result += text.substring(open);
            break;
        }

        // Extract key inside {{...}}
        let key = text.substring(open + 2, close).trim();

        // Replace with value if found, else keep original
        result += (values[key] !== undefined ? values[key] : "{{" + key + "}}");

        // Move past this placeholder
        startIndex = close + 2;
    }

    return result;
}


function getTextNodes(element, textNodes) {

    let children = element.childNodes;
    for (let i = 0; i < children.length; i++) {
        let node = children[i];

        if (node.nodeType === 3) { // Text node
            let text=node.nodeValue.trim();
            text=replaceMustachePlaceholders(text, { name: "John", age: 25 })
            node.nodeValue=text;
        } else if (node.nodeType === 1) { // Element node
            getTextNodes(node, textNodes); // recurse on the actual child
        }
    }
}

$(() => {
let text = "Hello {{name}}, {{ you are {{age}} years old.";
    //console.log(replaceMustachePlaceholders(text, { name: "John", age: 25 }));
    //console.log(replaceMustacheManual(text, { name: "John", age: 25 }));
    let body = document.body;
    let textNodes = [];

    getTextNodes(body, textNodes);

    alert("Found text nodes: " + textNodes.length);
    textNodes.forEach(t => alert(t.nodeValue.trim()));
});
</script>
<!--User part starts here-->
<script>
</script>
<body>
{{xyz}}
<div>
<b>"Hello {{name}}, you are {{age}} years old."</b>
</div>
</body>
</html>